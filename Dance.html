<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compacte Oneindige Carrousel</title>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #2424370d;
            touch-action: none;
        }

        #dvd-container {
            position: absolute;
            width: 260px;
            height: 260px;
            will-change: transform;
        }

        @media (max-width: 600px) {
            #dvd-container {
                width: 220px;
                height: 220px;
            }
        }

        #circle {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .item {
            position: absolute;
            width: 100px;
            height: 65px;
            top: 50%;
            left: 50%;
        }

        .item video {
            width: 150%;
            height: 150%;
            object-fit: cover;
            display: block;
        }
    </style>
</head>

<body>

<div id="dvd-container">
    <div id="circle"></div>
</div>

<script>
    const circle = document.getElementById("circle");
    const container = document.getElementById("dvd-container");

    /* 5 videos */
    const itemsData = [
        { src: "images/pigeon.mp4" },
        { src: "images/pigeon.mp4" },
        { src: "images/pigeon.mp4" },
        { src: "images/pigeon.mp4" },
        { src: "images/pigeon.mp4" }
    ];

    let radius = 110;
    const duration = 20000;
    const speed = (Math.PI * 2) / duration;
    const items = [];

    function updateRadius() {
        radius = window.innerWidth < 600 ? 90 : 110;
    }
    updateRadius();
    window.addEventListener("resize", updateRadius);

    /* Drag state */
    let isDragging = false;
    let lastTouchX = 0;
    let dragVelocity = 0;

    /* Items maken + staggered video start */
    itemsData.forEach((data, i) => {
        const el = document.createElement("div");
        el.className = "item";

        const video = document.createElement("video");
        video.src = data.src;
        video.loop = true;
        video.muted = true;
        video.playsInline = true;
        video.preload = "auto";

        el.appendChild(video);
        circle.appendChild(el);

        // videoâ€™s starten na elkaar
        setTimeout(() => {
            video.play().catch(() => {});
        }, i * 400);

        items.push({
            el,
            angle: (Math.PI * 2 / itemsData.length) * i
        });
    });

    /* Touch-drag */
    container.addEventListener("touchstart", e => {
        isDragging = true;
        lastTouchX = e.touches[0].clientX;
        dragVelocity = 0;
    });

    container.addEventListener("touchmove", e => {
        if (!isDragging) return;

        const x = e.touches[0].clientX;
        const deltaX = x - lastTouchX;
        lastTouchX = x;

        const rotationDelta = deltaX * 0.005;
        dragVelocity = rotationDelta;

        items.forEach(item => {
            item.angle += rotationDelta;
        });
    });

    container.addEventListener("touchend", () => {
        isDragging = false;
    });

    /* Carrousel animatie */
    let lastTime = performance.now();

    function animateCarousel(time) {
        const delta = time - lastTime;
        lastTime = time;

        if (!isDragging) {
            dragVelocity *= 0.95;
            items.forEach(item => {
                item.angle += speed * delta + dragVelocity;
            });
        }

        items.forEach(item => {
            const x = Math.cos(item.angle) * radius;
            const y = Math.sin(item.angle) * radius;

            item.el.style.transform =
                `translate(${x}px, ${y}px) translate(-50%, -50%)`;
        });

        requestAnimationFrame(animateCarousel);
    }

    requestAnimationFrame(animateCarousel);

    /* DVD-bounce */
    let x = 60, y = 60;
    let vx = 1.1, vy = 1.0;

    function moveDVD() {
        const w = window.innerWidth;
        const h = window.innerHeight;
        const rect = container.getBoundingClientRect();

        x += vx;
        y += vy;

        if (x <= 0 || x + rect.width >= w) vx *= -1;
        if (y <= 0 || y + rect.height >= h) vy *= -1;

        container.style.transform = `translate3d(${x}px, ${y}px, 0)`;
        requestAnimationFrame(moveDVD);
    }

    moveDVD();
</script>

</body>
</html>
